import unittest

from clinical_mdr_api import exceptions
from clinical_mdr_api.domains.study_definition_aggregates.registry_identifiers import (
    RegistryIdentifiersVO,
)

# Goal is to test the business logic of the class


class TestRegistryIdentifiers(unittest.TestCase):
    def test__validate__valid_data__success(self):
        test_tuples = [
            (
                "ct-gov-id",
                "eudract-id",
                "universal-trial-number-UTN",
                "japanese-trial-registry-id-JAPIC",
                "investigational-new-drug-application-number-IND",
                "eu-trial-number",
                "civ-id-sin-number",
                "national-clinical-trial-number",
                "japanese-trial-registry-number-jrct",
                "national-medical-products-administration-nmpa-number",
                "eudamed-srn-number",
                "investigational-device-exemption-ide-number",
                None,
            ),
            (
                "ct-gov-id",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
            ),
            (
                None,
                "eudract-id",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
            ),
            (
                None,
                None,
                "universal-trial-number-UTN",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
            ),
            (
                None,
                None,
                None,
                "japanese-trial-registry-id-JAPIC",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
            ),
            (
                None,
                None,
                None,
                None,
                "investigational-new-drug-application-number-IND",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
            ),
            (
                None,
                None,
                None,
                None,
                None,
                "eu-trial-number",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                "civ-id-sin-number",
                None,
                None,
                None,
                None,
                None,
                None,
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "national-clinical-trial-number",
                None,
                None,
                None,
                None,
                None,
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "japanese-trial-registry-number-jrct",
                None,
                None,
                None,
                None,
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "national-medical-products-administration-nmpa-number",
                None,
                None,
                None,
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "eudamed-srn-number",
                None,
                None,
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "investigational-device-exemption-ide-number",
                None,
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
            ),
        ]
        for test_tuple in test_tuples:
            with self.subTest(test_tuple=test_tuple):
                registry_identifier = RegistryIdentifiersVO(
                    ct_gov_id=test_tuple[0],
                    eudract_id=test_tuple[1],
                    universal_trial_number_utn=test_tuple[2],
                    japanese_trial_registry_id_japic=test_tuple[3],
                    investigational_new_drug_application_number_ind=test_tuple[4],
                    eu_trial_number=test_tuple[5],
                    civ_id_sin_number=test_tuple[6],
                    national_clinical_trial_number=test_tuple[7],
                    japanese_trial_registry_number_jrct=test_tuple[8],
                    national_medical_products_administration_nmpa_number=test_tuple[9],
                    eudamed_srn_number=test_tuple[10],
                    investigational_device_exemption_ide_number=test_tuple[11],
                    ct_gov_id_null_value_code=test_tuple[12],
                    eudract_id_null_value_code=test_tuple[12],
                    universal_trial_number_utn_null_value_code=test_tuple[12],
                    japanese_trial_registry_id_japic_null_value_code=test_tuple[12],
                    investigational_new_drug_application_number_ind_null_value_code=test_tuple[
                        12
                    ],
                    eu_trial_number_null_value_code=test_tuple[12],
                    civ_id_sin_number_null_value_code=test_tuple[12],
                    national_clinical_trial_number_null_value_code=test_tuple[12],
                    japanese_trial_registry_number_jrct_null_value_code=test_tuple[12],
                    national_medical_products_administration_nmpa_number_null_value_code=test_tuple[
                        12
                    ],
                    eudamed_srn_number_null_value_code=test_tuple[12],
                    investigational_device_exemption_ide_number_null_value_code=test_tuple[
                        12
                    ],
                )
                registry_identifier.validate()

    def test__validate__valid_data__failure(self):
        test_tuples = [
            (
                "ct-gov-id",
                "eudract-id",
                "universal-trial-number-UTN",
                "japanese-trial-registry-id-JAPIC",
                "investigational-new-drug-application-number-IND",
                "eu-trial-number",
                "civ-id-sin-number",
                "national-clinical-trial-number",
                "japanese-trial-registry-number-jrct",
                "national-medical-products-administration-nmpa-number",
                "eudamed-srn-number",
                "investigational-device-exemption-ide-number",
                "missing-reason",
            ),
            (
                "ct-gov-id",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                "eudract-id",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                "universal-trial-number-UTN",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                "japanese-trial-registry-id-JAPIC",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                None,
                "investigational-new-drug-application-number-IND",
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                None,
                None,
                "eu-trial-number",
                None,
                None,
                None,
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                "civ-id-sin-number",
                None,
                None,
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "national-clinical-trial-number",
                None,
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "japanese-trial-registry-number-jrct",
                None,
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "national-medical-products-administration-nmpa-number",
                None,
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "eudamed-srn-number",
                None,
                "missing-reason",
            ),
            (
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                None,
                "investigational-device-exemption-ide-number",
                "missing-reason",
            ),
        ]
        for test_tuple in test_tuples:
            with self.subTest(test_tuple=test_tuple):
                registry_identifier = RegistryIdentifiersVO(
                    ct_gov_id=test_tuple[0],
                    eudract_id=test_tuple[1],
                    universal_trial_number_utn=test_tuple[2],
                    japanese_trial_registry_id_japic=test_tuple[3],
                    investigational_new_drug_application_number_ind=test_tuple[4],
                    eu_trial_number=test_tuple[5],
                    civ_id_sin_number=test_tuple[6],
                    national_clinical_trial_number=test_tuple[7],
                    japanese_trial_registry_number_jrct=test_tuple[8],
                    national_medical_products_administration_nmpa_number=test_tuple[9],
                    eudamed_srn_number=test_tuple[10],
                    investigational_device_exemption_ide_number=test_tuple[11],
                    ct_gov_id_null_value_code=test_tuple[12],
                    eudract_id_null_value_code=test_tuple[12],
                    universal_trial_number_utn_null_value_code=test_tuple[12],
                    japanese_trial_registry_id_japic_null_value_code=test_tuple[12],
                    investigational_new_drug_application_number_ind_null_value_code=test_tuple[
                        12
                    ],
                    eu_trial_number_null_value_code=test_tuple[12],
                    civ_id_sin_number_null_value_code=test_tuple[12],
                    national_clinical_trial_number_null_value_code=test_tuple[12],
                    japanese_trial_registry_number_jrct_null_value_code=test_tuple[12],
                    national_medical_products_administration_nmpa_number_null_value_code=test_tuple[
                        12
                    ],
                    eudamed_srn_number_null_value_code=test_tuple[12],
                    investigational_device_exemption_ide_number_null_value_code=test_tuple[
                        12
                    ],
                )
                with self.assertRaises(exceptions.ValidationException):
                    registry_identifier.validate()
